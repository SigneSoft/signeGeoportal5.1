/*
 * File: app.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

// @require @packageOverrides
Ext.Loader.setConfig({
    paths: {
        GeoExt: '../geoext2210/src/GeoExt'
    }
});


Ext.application({

    requires: [
        'Ext.Loader'
    ],
    xClase: 0,
    models: [
        'modelParametro',
        'modelLogin'
    ],
    stores: [
        'storeCatalogo',
        'storeParametro',
        'storeLogin'
    ],
    views: [
        'Escritorio',
        'LegendPanel',
        'MapPanel',
        'Map',
        'ListaLayer',
        'InfoPanel',
        'ContentPanel',
        'VentanaParametro',
        'clsLogin'
    ],
    controllers: [
        'controllerMapa',
        'controllerLogin'
    ],
    name: 'signeGeoportal',

    launch: function() {
        Ext.create('signeGeoportal.view.clsLogin', {renderTo: Ext.getBody()});
    },

    aniadirCapa: function(titulo_capa, url_capa, nombre_capa, clone, variables, parametros, texto) {
        if (!parametros){
            var wms = new OpenLayers.Layer.WMS(
                clone.title,
                clone.url,
                {layers:clone.name,
                 transparent : 'true',
                 format: 'image/png'
                },
                {opacity: 0.7,
                 isBaseLayer: false,
                 //displayInLayerSwitcher:false
                 //     attribution: "<img src='"+url_capa+"request=GetLegendGraphic&format=image/png&width=18&height=17&layer="+nombre_capa+"&legend_options=fontName:Times%20New%20Roman;fontAntiAliasing:true;fontColor:0x000033;fontSize:12;bgColor:0xFFFFEE;dpi:180'>"
                }
            );

            signeGeoportal.xMap.map.addLayer(wms);
        }else{


            var wms = new OpenLayers.Layer.WMS(
                clone.title + " " + texto,
                clone.url + variables,
                {layers:clone.name,
                 transparent : 'true',
                 format: 'image/png',
                 viewparams: parametros,
                },
                {opacity: 0.7,
                 isBaseLayer: false
                 //displayInLayerSwitcher:false
                 //     attribution: "<img src='"+url_capa+"request=GetLegendGraphic&format=image/png&width=18&height=17&layer="+nombre_capa+"&legend_options=fontName:Times%20New%20Roman;fontAntiAliasing:true;fontColor:0x000033;fontSize:12;bgColor:0xFFFFEE;dpi:180'>"
                }
            );

            signeGeoportal.xMap.map.addLayer(wms);

            Ext.MessageBox.show({
                title: 'Mensaje del Sistema',
                msg: 'La capa se esta cargando al visor del mapa.',
                icon: Ext.MessageBox.INFO,
                buttons: Ext.Msg.OK
            });
        }


    },

    obtenerLayer: function() {
        var arbolCapa = Ext.getCmp("treelayer");
        record = arbolCapa.getSelectionModel().getSelection()[0];
        layer = signeGeoportal.xMap.map.getLayer(record.data.layer.id);

        return layer;
        //alert("func cambiando opacidad");


    },

    toggleControl: function(element) {
        for (var key in signeGeoportal.xMeasure) {
            if(element.id === "lineToggle"){
                value = "line";
            }else if(element.id === "polygonToggle"){
                value = "polygon";
            }else{
                value = "none";
            }

            if (value === key && element.pressed) {
                signeGeoportal.xMeasure[key].activate();
            } else {
                signeGeoportal.xMeasure[key].deactivate();
            }
        }
    }

});
