{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "controllerMapa",
        "views": [
            "LegendPanel"
        ]
    },
    "name": "MyController",
    "designerId": "57b5bd24-aacb-4e2b-b591-bcf482d529b8",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnEnfocar",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnEnfocarClick",
                "implHandler": [
                    "signeGeoportal.xMap.map.zoomToScale(2000000,false);",
                    "",
                    "//signePortal.xMap.zoomToExtent(new OpenLayers.Bounds(minLng,minLat,maxLng,maxLat));"
                ],
                "name": "click"
            },
            "name": "onBtnEnfocarClick",
            "designerId": "f6bd9f62-343b-4527-8cf1-f2e3728865e0"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnEliminarCapa",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnEliminarCapaClick",
                "implHandler": [
                    "var layer = signeGeoportal.getApplication().obtenerLayer();",
                    "",
                    "if (layer){",
                    "    Ext.MessageBox.show({",
                    "        title : 'Eliminar Capa',",
                    "        buttons : Ext.MessageBox.YESNO,",
                    "        msg : 'Realmente desea eliminar la capa ' + record.data.layer.name +  ' del mapa ?',",
                    "        icon : Ext.Msg.WARNING,",
                    "        fn : function(btn)",
                    "        {",
                    "            if (btn == 'yes')",
                    "            {",
                    "                signeGeoportal.xMap.map.removeLayer(layer);",
                    "            }",
                    "",
                    "        }",
                    "    });",
                    "}",
                    "",
                    "",
                    ""
                ],
                "name": "click"
            },
            "name": "onBtnEliminarCapaClick",
            "designerId": "c0698dc8-8eeb-4965-a752-0c1242a76e25"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnImprimir",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnImprimirClick",
                "implHandler": [
                    "var printExtent = Ext.create('GeoExt.plugins.PrintExtent', {",
                    "    printProvider: printProvider",
                    "});",
                    "",
                    "printDialog = Ext.create('Ext.Window', {",
                    "    height: 580,",
                    "    width: 450,",
                    "    layout: 'border',",
                    "    title: 'Vista previa de impresi칩n.',",
                    "    modal: true,",
                    "    items: [",
                    "        {",
                    "            xtype: 'panel',",
                    "            region: 'north',",
                    "            layout: 'fit',",
                    "            title: '',",
                    "            dockedItems: [",
                    "                {",
                    "                    xtype: 'toolbar',",
                    "                    dock: 'top',",
                    "                    items: [",
                    "                        {",
                    "                            xtype: 'button',",
                    "                            id: 'btnImprimirMapa',",
                    "                            text: 'Imprimir PDF',",
                    "                            iconCls: 'print-pdf',",
                    "                            handler: function(){",
                    "                                var legendlayer = Ext.getCmp('legendlayer');",
                    "                                var printMapPanel = Ext.getCmp('printmappanel');",
                    "",
                    "                                var includeLegend;",
                    "                                includeLegend = true;",
                    "         ",
                    "                                var scale = printProvider.scales.getAt(1);",
                    "                                printPage.setScale(scale, \"m\");",
                    "",
                    "",
                    "                                printProvider.customParams.mapTitle = Ext.getCmp('txtTitulo').getValue();",
                    "                                printProvider.customParams.comment = Ext.getCmp('txtComentario').getValue();",
                    "                                ",
                    "                                var opt = {\"mode\":\"screen\"};",
                    "                                printPage.fit(printMapPanel, opt);",
                    "                                ",
                    "                                printProvider.setDpi(printProvider.dpis.getAt(1));",
                    "                                printProvider.print(printMapPanel, printPage, includeLegend && {legend: legendlayer});",
                    "                            }",
                    "",
                    "                        }",
                    "                    ]",
                    "                }",
                    "            ],",
                    "            items: [",
                    "                {",
                    "                    xtype: 'fieldset',",
                    "                    height: 120,",
                    "                    title: 'Informaci칩n del mapa',",
                    "                    items: [",
                    "                        {",
                    "                            xtype: 'textfield',",
                    "                            anchor: '100%',",
                    "                            id: 'txtTitulo',",
                    "                            fieldLabel: 'Titulo',",
                    "                            name: 'tituloMapa',",
                    "                            allowBlank: false",
                    "                        },",
                    "                        {",
                    "                            xtype: 'textareafield',",
                    "                            anchor: '100%',",
                    "                            id: 'txtComentario',",
                    "                            fieldLabel: 'Comentario',",
                    "                            name: 'comentarioMapa',",
                    "                            allowBlank: false",
                    "                        }",
                    "                    ]",
                    "                }",
                    "            ]",
                    "        },",
                    "        {",
                    "            xtype: 'panel',",
                    "            items: {",
                    "                xtype: \"gx_printmappanel\",",
                    "                id: 'printmappanel',",
                    "                sourceMap: signeGeoportal.xMap,",
                    "                printProvider: printProvider,",
                    "                //center: new OpenLayers.LonLat(-10048800, 1735400),",
                    "                //limitScales:true,",
                    "                //plugins: [printExtent],",
                    "            },",
                    "            region: 'center',",
                    "            layout: 'fit',",
                    "        }]",
                    "});",
                    "",
                    "",
                    "printDialog.show();",
                    "",
                    "//printExtent.addPage();",
                    ""
                ],
                "name": "click"
            },
            "name": "onBtnImprimirClick",
            "designerId": "e0c461fd-c825-4b3f-be06-62b84c273af4"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnAniadirCapa",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnAniadirCapaClick",
                "implHandler": [
                    "var pgParametro = Ext.getCmp('pgParametro');",
                    "data = pgParametro.getSource();",
                    "store = pgParametro.getStore();",
                    "var strParametros = \"\";",
                    "var strTexto = \"\";",
                    "",
                    "var error = false;",
                    "",
                    "for(var i=0;i<store.data.items.length;i++)",
                    "{",
                    "    strParametros = strParametros + \"p\" + i + \":\" + store.data.items[i].data.value + \";\";",
                    "    strTexto = strTexto + store.data.items[i].data.value + \" \";",
                    "",
                    "    if (!store.data.items[i].data.value){",
                    "",
                    "        error = true;",
                    "//        console.log(store.data.items[i]);",
                    "    }",
                    "}",
                    "",
                    "if (error === true){",
                    "    Ext.Msg.show({",
                    "        title: 'Mensaje del Sistema',",
                    "        msg: 'No es posible a침adir la capa debido que existen par치metros que no se han definido.',",
                    "        buttons: Ext.Msg.OK,",
                    "        icon: Ext.MessageBox.INFO",
                    "    });",
                    "}else{",
                    "    signeGeoportal.getApplication().aniadirCapa(signeGeoportal.xClone.title, signeGeoportal.xClone.url, signeGeoportal.xClone.name, signeGeoportal.xClone, strParametros, strTexto);",
                    "}",
                    "",
                    ""
                ],
                "name": "click"
            },
            "name": "onBtnAniadirCapaClick",
            "designerId": "df4476bf-411f-43df-ae8d-e1b041afc4a8"
        }
    ]
}